---
import PortfolioCard from "@/components/PortfolioCard.astro";
import PortfolioModal from "@/components/PortfolioModal.astro";
import Button from "@/components/ui/Button.astro";
import { getFirstInvitaciones, getInvitacionModalData } from "@/data/invitaciones";

const invitaciones = getFirstInvitaciones();
---

<section id="demos" class="py-20 lg:py-32 px-6 relative overflow-x-hidden">
  <div class="absolute inset-0">
    <div
      class="absolute bottom-10 left-1/4 w-96 h-96 rounded-full opacity-10 bg-teal-500 blur-3xl"
    >
    </div>
    <div
      class="absolute top-10 right-1/3 w-80 h-80 rounded-full opacity-10 bg-sky-500 blur-3xl"
    >
    </div>
  </div>
  <div class="max-w-7xl mx-auto relative z-10">
    <!-- Headline -->
    <div class="text-center mb-20">
      <h2 class="font-sora font-bold text-4xl lg:text-6xl text-gray-900 mb-6">
        Invitaciones Digitales que <span class="text-indigo-600">Inspiran</span>
      </h2>
      <p
        class="font-sora font-normal text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed mb-8"
      >
        Creamos experiencias únicas para bodas, eventos corporativos y
        celebraciones especiales. No usamos plantillas: cada invitación es
        diseñada y programada a la medida.
      </p>
    </div>

    <!-- Grid de proyectos -->
    <ul
      id="portfolio-grid"
      class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-6"
    >
      {
        invitaciones.map((invitacion, index) => (
          <PortfolioCard project={invitacion} index={index} />
        ))
      }
    </ul>

    <!-- Botón mostrar más -->
    <!-- {invitaciones.length > 4 && (
      <div id="show-more-container" class="text-center mt-16 hidden">
        <Button id="show-more-btn" variant="secondary" size="lg" className="xs:min-w-[280px] h-[56px]">
          <span class="btn-text">Mostrar Más Proyectos</span>
          <div class="btn-loader hidden">
            <span class="dot" /><span class="dot" /><span class="dot" />
          </div>
        </Button>
      </div>
    )} -->

    <!-- Nota de confianza -->
    <p class="text-center text-gray-500 text-sm mt-12 font-sora">
      ⭐ Tu invitación personalizada también podrá aparecer en nuestro
      portafolio para inspirar a otros clientes.
    </p>
  </div>

  <PortfolioModal />
</section>

<script>
  import { getInvitacionModalData } from "@/data/invitaciones";

  const cards = document.querySelectorAll("#portfolio-grid li");
  cards.forEach((card) => {
    card.addEventListener("click", () => {
      const index = parseInt(card.dataset.index, 10);
      const data = getInvitacionModalData(index);

      if (data) {
        window.dispatchEvent(new CustomEvent("openModal", { detail: data }));
      }
    });
  });
</script>

<style>
  /* ✅ CAMBIO: CSS para manejar el estado de carga del botón */
  #show-more-btn .btn-loader {
    display: none; /* Oculto por defecto */
  }

  #show-more-btn.is-loading .btn-loader {
    display: flex; /* Se muestra cuando el botón está cargando */
    justify-content: center;
    align-items: center;
    gap: 8px;
  }

  #show-more-btn.is-loading .btn-text {
    display: none; /* Se oculta el texto cuando está cargando */
  }

  #show-more-btn.is-loading {
    cursor: wait;
  }

  /* Animación de los puntos del loader */
  .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--brand-indigo);
    animation: pulse-dot 1.4s ease-in-out infinite;
  }
  .dot:nth-child(2) {
    animation-delay: 0.2s;
  }
  .dot:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes pulse-dot {
    0%,
    100% {
      transform: scale(0.8);
      opacity: 0.5;
    }
    50% {
      transform: scale(1.2);
      opacity: 1;
    }
  }
</style>
